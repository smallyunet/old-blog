<!DOCTYPE html>
<html>

<!-- Mirrored from oldblog.smallyu.net/?id=65 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Jan 2020 07:47:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>Z-Blog插件：站点信息统计_未分类_smallyu</title>
<meta name="keywords" content="Z-Blog"/>
<meta name="description" content="在系统原有的站点信息的基础上，增加了文章总字数和页面总字数统计；可自定义显示条目。后台配置页面，1为显示，0为不显示，提交后保存，属性同其它系统模块。前台显示效果会受到主题样式影响。附件：SiteInfoCount.zip偶然想到要统计一下自己博客上文章的总字数，几经辗..."/>
<meta name="author" content="smallyu">
<link rel='prev' title='我的世界，你做主' href='index3221.html?id=63' />
<link rel='canonical' href='indexf8d4.html?id=65' />
<link rel='shortlink' href='indexf8d4.html?id=65' />
<meta name="viewport" content="width=device-width, initial-scale=1">
 <style type="text/css">
    .home::before {
    font-size: 90px;
    font-family: 'efe-icons';
    content: "";
    display: block;
    margin-bottom: 10px;
}
</style>
<link rel="stylesheet" href="zb_users/theme/ydefe/style/page.min.css" type="text/css">
<script src="zb_system/script/jquery-2.2.4.min.js" type="text/javascript"></script>
<script src="zb_system/script/zblogphp.js" type="text/javascript"></script>
<script src="zb_system/script/c_html_js_add.js" type="text/javascript"></script>
</head><body>

<aside>
	<a class="home" href="index.html" title="smallyu">
	    <img src="zb_users/theme/ydefe/style/images/logo.png" /><br />
        <abbr title="EFE">smallyu</abbr>
    </a>
  <nav> <a href="Hello%20World.html" target="_blank">Hello World</a> </nav>
  <div class="sidebarleft-mb">
    <ul class="product-overview-side-mb">
      <li id="nvabar-item-index"><a href="index.html">首页</a></li>
<li id="navbar-page-16"><a href="index2728.html?id=16">关于</a></li>
    </ul>
  </div>
      
<div class="sidebarleft widget_navbar">
   
  <div class="product-overview-side efe-desc widget_divNavBar_inner"><div class="sidebg"><li id="nvabar-item-index"><a href="index.html">首页</a></li>
<li id="navbar-page-16"><a href="index2728.html?id=16">关于</a></li>
</div></div>
         
 
</div>
<div class="sidebarleft widget_archives">
<h4>文章归档</h4>
   
         
  <ul class="product-overview-side ">
 <li><a href="indexb0b4.html?date=2017-8">2017年8月 (6)</a></li>
<li><a href="indexcb7e.html?date=2017-7">2017年7月 (2)</a></li>
<li><a href="index276d.html?date=2017-6">2017年6月 (3)</a></li>
<li><a href="index5523.html?date=2017-5">2017年5月 (2)</a></li>
<li><a href="indexb2e3.html?date=2017-4">2017年4月 (2)</a></li>
<li><a href="index10ae.html?date=2017-3">2017年3月 (3)</a></li>
<li><a href="index8cef.html?date=2017-2">2017年2月 (3)</a></li>
<li><a href="index8bcc.html?date=2017-1">2017年1月 (4)</a></li>
<li><a href="index9f2f.html?date=2016-12">2016年12月 (1)</a></li>
<li><a href="index50f5.html?date=2016-11">2016年11月 (2)</a></li>
<li><a href="indexf32d.html?date=2016-10">2016年10月 (3)</a></li>
<li><a href="index91d7.html?date=2016-9">2016年9月 (1)</a></li>
<li><a href="index917c.html?date=2016-8">2016年8月 (6)</a></li>
<li><a href="index34d3.html?date=2016-7">2016年7月 (1)</a></li>
<li><a href="indexe6af.html?date=2016-6">2016年6月 (4)</a></li>
<li><a href="index1d06.html?date=2016-5">2016年5月 (4)</a></li>
 </ul>
 
</div>  </aside>


<article>
    
        <h1><a href="indexf8d4.html?id=65">Z-Blog插件：站点信息统计</a></h1>
    

    <div class="article-meta">
        <span class="article-author">
        
        <i class="fa fa-pencil"></i>
        <a target="_blank" href="indexd381.html?auth=1" title="otakustay">smallyu</a>
    
</span>

        <time><i class="fa fa-clock-o"></i> 2017-08-31</time>

        
        <span class="article-tags"><i class="fa fa-tag"></i> <a href="index6833.html?tags=1" target="_blank">Z-Blog</a>&nbsp;</span>
	    
    
    </div>
        <p style="white-space: normal;">在系统原有的站点信息的基础上，增加了文章总字数和页面总字数统计；可自定义显示条目。<br/></p><p style="white-space: normal;"><img src="zb_users/upload/2017/08/201708311504159671197077.png" title="搜狗截图20170831140253.png"/></p><p style="white-space: normal;">后台配置页面，1为显示，0为不显示，提交后保存，属性同其它系统模块。</p><p style="white-space: normal;"><img src="zb_users/upload/2017/08/201708311504159671696231.png" title="搜狗截图20170831140134.png"/></p><p style="white-space: normal;">前台显示效果会受到主题样式影响。</p><p style="white-space: normal;">附件：<a href="zb_users/upload/2017/08/201708311504162009746764.zip" title="SiteInfoCount.zip" style="line-height: 16px; font-size: 12px; color: rgb(0, 102, 204);">SiteInfoCount.zip</a></p><p style="white-space: normal;"><br/></p><hr/><p style="white-space: normal;"><br/></p><p style="white-space: normal;">偶然想到要统计一下自己博客上文章的总字数，几经辗转，还是新建一个插件，开始看着官方文档，试图实现这个功能。</p><p style="white-space: normal;">这是smallyu尝试开发的第一个zblog插件。</p><p style="white-space: normal;">插件目录使用系统默认的结构，插件嵌入页include.php和插件管理页main.php。<br/></p><p style="white-space: normal;">经过一整天+的探索时间，smallyu渐渐明白了zblog插件的运行机制，最终实现了包括但不限于文章总字数统计的功能。<br/></p><p style="white-space: normal;">因为之前smallyu就受限于系统自带的站点信息不能定制化显示，于是这次在插件上添加了这样的功能。<br/></p><p style="white-space: normal;">也因为smallyu比较懒，可能代码的实现形式比较low，也没有考虑插件给系统性能带来的影响，如果有机会，也许smallyu会重构这个插件的代码。</p><p style="white-space: normal;">同时因为zblog后台并不支持直接提交插件到官方审核，然后smallyu对这个插件也非常没有信心，不认为能够通过审核，就不掺和了。</p><p style="white-space: normal;"><br/></p><p style="white-space: normal;">在插件嵌入页include.php，一共挂载了5个接口，当这些接口事件发生时，模块内容就会被更新（但前台页面需要重新编译）。</p><pre class="prism-highlight prism-language-php">function&nbsp;ActivePlugin_SiteInfoCount()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;Add_Filter_Plugin(&#39;Filter_Plugin_Zbp_BuildTemplate&#39;,&#39;updateSIC&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;模板重新编译接口
&nbsp;&nbsp;&nbsp;&nbsp;Add_Filter_Plugin(&#39;Filter_Plugin_PostArticle_Succeed&#39;,&#39;updateSIC&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;文章编辑成功接口
&nbsp;&nbsp;&nbsp;&nbsp;Add_Filter_Plugin(&#39;Filter_Plugin_DelArticle_Succeed&#39;,&#39;updateSIC&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;文章删除成功接口
&nbsp;&nbsp;&nbsp;&nbsp;Add_Filter_Plugin(&#39;Filter_Plugin_PostPage_Succeed&#39;,&#39;updateSIC&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;页面编辑成功接口
&nbsp;&nbsp;&nbsp;&nbsp;Add_Filter_Plugin(&#39;Filter_Plugin_DelPage_Succeed&#39;,&#39;updateSIC&#39;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;页面删除成功接口
}</pre><p style="white-space: normal;">插件的ID定义为SiteInfoCount，简写为SIC。官方定义了插件接口的挂载函数ActivePlugin_ID，在该函数里可以使用Add_Filter_Plugin函数挂载系统接口。</p><p style="white-space: normal;">当文章或页面被编辑，统计字数就会发生改变，所以在这些事件发生时，需要更新模块内容，这里定义更新模块内容的函数为updateSIC，也就是接管系统接口之后会被执行的函数。</p><pre class="prism-highlight prism-language-php">function&nbsp;updateSIC()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;$zbp;
&nbsp;&nbsp;&nbsp;&nbsp;$config&nbsp;=&nbsp;configInit();
&nbsp;&nbsp;&nbsp;&nbsp;if(isset($zbp-&gt;modulesbyfilename[&#39;SICMoudle&#39;])){
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$zbp-&gt;modulesbyfilename[&#39;SICMoudle&#39;]-&gt;Content&nbsp;=&nbsp;cttBycof($config);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;$zbp-&gt;AddBuildModule(&#39;SICMoudle&#39;,&nbsp;&#39;updateSIC&#39;);
}</pre><p style="white-space: normal;">这是updateSIC函数的内容。先声明使用全局变量$zbp，然后获取配置信息到变量$config，其中configInit函数是自定义的函数。if语句判断模块是否存在，如果存在则更改模块内容。最后面的语句<strong>可能</strong>是用于执行更新，samllyu并没有完全了解zblog的函数。<br/></p><p style="white-space: normal;">理论上更新模块有两种方式，一种是if语句内的样子，直接更改模块内容，另一种是使用下面的AddBuildMoudle函数执行更新模块的操作，函数内的两个参数分别表示要更新的模块是执行更新的用户函数。</p><p style="white-space: normal;">smallyu懒得测试模块到底是怎样更新的了，就把两句都写上，反正程序可以正常执行……即使是更新了两次模块，也并不会给系统带来太大额外开销。</p><pre class="prism-highlight prism-language-php">function&nbsp;configInit($config&nbsp;=&nbsp;array()){
&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;$zbp;
&nbsp;&nbsp;&nbsp;&nbsp;$configFileName&nbsp;=&nbsp;&quot;config.sic&quot;;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;文件不存在、没有参数
&nbsp;&nbsp;&nbsp;&nbsp;if(!is_file($configFileName)&nbsp;&amp;&amp;&nbsp;count($config)&nbsp;==&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config&nbsp;=&nbsp;array(1,&nbsp;2,&nbsp;3,&nbsp;4,&nbsp;5,&nbsp;6,&nbsp;7,&nbsp;8);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configInput($config);
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;文件存在
&nbsp;&nbsp;&nbsp;&nbsp;if(is_file($configFileName))&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;有参数
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(count($config)&nbsp;!=&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;configInput($config);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;没有参数，读取文件
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$configText&nbsp;=&nbsp;file_get_contents($zbp-&gt;host.&quot;zb_users/plugin/SiteInfoCount/&quot;.$configFileName);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$config&nbsp;=&nbsp;explode(&quot;|&quot;,&nbsp;$configText);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;$config;
}</pre><p style="white-space: normal;">这是上面用到的configInit函数。函数接收一个数组类型的参数，用于处理插件管理页面提交并需要保存的配置。</p><p style="white-space: normal;">没错，配置信息是写入到文件里的，读取分别使用explode和implode将字符串分割为数组。</p><p style="white-space: normal;">至于为什么，smallyu之前不知道zblog系统提供了选项机制，可以使用类似$zbp-&gt;Config(&quot;ID&quot;)-&gt;test的形式储存数据，然后就没有改。虽然代码量不大，但要把数据从文件储存全部换成使用选项机制储存，也相当于重构整个插件了。</p><p style="white-space: normal;">文件储存也并不影响使用，就是看起来新手一点。</p><p style="white-space: normal;">其它使用到的函数还有：</p><pre class="prism-highlight prism-language-php">moudleInit();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;初始化模块，也就是新建模块，函数内配置了模块的一些信息
configInput();&nbsp;&nbsp;&nbsp;//&nbsp;细化的配置写入函数，在postInit函数里调用
cttBycof();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;根据config检出content，接收数组参数
postInit();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;处理提交的配置信息</pre><p style="white-space: normal;">每个函数的代码量都不大。其中站点信息截取了ModuleBuilder类的Statistics方法，直接获取到了字符串形式的站点信息。</p><p style="white-space: normal;">插件管理页面main.php则只是把数据填充过来，其中也用到了看起来不太好的for循环，还把循环次数写死了，像这样：<br/></p><pre class="prism-highlight prism-language-php">//&nbsp;数组转存
foreach($config&nbsp;as&nbsp;$value)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;$config[$value]&nbsp;=&nbsp;$value;
}
//&nbsp;获得显示数组
for($i&nbsp;=&nbsp;1;&nbsp;$i&nbsp;&lt;=8;&nbsp;$i++)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;$cofValue[$i]&nbsp;=&nbsp;$config[$i]&nbsp;==&nbsp;$i&nbsp;?&nbsp;1&nbsp;:&nbsp;0;
}</pre><p style="white-space: normal;">从代码上看，好像不明所以。是的，仅仅过了一个小时，smallyu现在也不明所以……</p><p style="white-space: normal;">-------------------------------------</p><p style="white-space: normal;">刚才zblog社区有人说插件改0后会出错</p><p style="white-space: normal;">应该是全部改0后，会写入配置文件空的内容，然后取配置的时候没能得到参数，程序就报错了，这个bug之前好像也遇到过</p><p style="white-space: normal;">全部改0意思就是不显示任何内容，那么……也许可以试着直接把模块撤掉……这样就可以不显示任何内容了</p><p style="white-space: normal;">好吧，我懒……得改</p><p style="white-space: normal;"><br/></p>    
</article>
<nav class="article-pagination">
    
    <a href="index3221.html?id=63" class="article-prev">前一篇: 我的世界，你做主</a>    </nav>



<footer>
<p class="copy">Copyright Hower'Blog Rights Reserved.&nbsp;&nbsp;. Powered By <a href="http://www.zblogcn.com/" rel="nofollow" target="_blank">Z-BlogPHP</a>. theme by <a href="http://www.laiweishang.com/" target="_blank">微商货源</a></p></footer>
<script defer src="../static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"rayId":"557f6ebbdafdebb5","version":"2019.10.2","startTime":1579506364803}'></script>
</body>
<!-- Mirrored from oldblog.smallyu.net/?id=65 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Jan 2020 07:47:12 GMT -->
</html>


<!--5.91 ms , 9 query , 646kb memory , 0 error-->