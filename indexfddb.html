<!DOCTYPE html>
<html>

<!-- Mirrored from oldblog.smallyu.net/?id=52 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Jan 2020 07:50:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>HTML5音乐可视化_未分类_smallyu</title>
<meta name="keywords" content="HTML5"/>
<meta name="description" content="在线demo：http://oldblog.smallyu.net/web/passionate/下面梳理一下HTML5实现音乐可视化的流程。搭建静态页面静态页面的结构分三部分，header，left，right。header为语义化标签，left和right都用div..."/>
<meta name="author" content="smallyu">
<link rel='prev' title='活着那么累，和我一起去死吧' href='index7d36.html?id=51' />
<link rel='next' title='大误：被人嫌弃的感觉是这样的' href='index3ca5.html?id=53' />
<link rel='canonical' href='indexfddb.html?id=52' />
<link rel='shortlink' href='indexfddb.html?id=52' />
<meta name="viewport" content="width=device-width, initial-scale=1">
 <style type="text/css">
    .home::before {
    font-size: 90px;
    font-family: 'efe-icons';
    content: "";
    display: block;
    margin-bottom: 10px;
}
</style>
<link rel="stylesheet" href="zb_users/theme/ydefe/style/page.min.css" type="text/css">
<script src="zb_system/script/jquery-2.2.4.min.js" type="text/javascript"></script>
<script src="zb_system/script/zblogphp.js" type="text/javascript"></script>
<script src="zb_system/script/c_html_js_add.js" type="text/javascript"></script>
</head><body>

<aside>
	<a class="home" href="index.html" title="smallyu">
	    <img src="zb_users/theme/ydefe/style/images/logo.png" /><br />
        <abbr title="EFE">smallyu</abbr>
    </a>
  <nav> <a href="Hello%20World.html" target="_blank">Hello World</a> </nav>
  <div class="sidebarleft-mb">
    <ul class="product-overview-side-mb">
      <li id="nvabar-item-index"><a href="index.html">首页</a></li>
<li id="navbar-page-16"><a href="index2728.html?id=16">关于</a></li>
    </ul>
  </div>
      
<div class="sidebarleft widget_navbar">
   
  <div class="product-overview-side efe-desc widget_divNavBar_inner"><div class="sidebg"><li id="nvabar-item-index"><a href="index.html">首页</a></li>
<li id="navbar-page-16"><a href="index2728.html?id=16">关于</a></li>
</div></div>
         
 
</div>
<div class="sidebarleft widget_archives">
<h4>文章归档</h4>
   
         
  <ul class="product-overview-side ">
 <li><a href="indexb0b4.html?date=2017-8">2017年8月 (6)</a></li>
<li><a href="indexcb7e.html?date=2017-7">2017年7月 (2)</a></li>
<li><a href="index276d.html?date=2017-6">2017年6月 (3)</a></li>
<li><a href="index5523.html?date=2017-5">2017年5月 (2)</a></li>
<li><a href="indexb2e3.html?date=2017-4">2017年4月 (2)</a></li>
<li><a href="index10ae.html?date=2017-3">2017年3月 (3)</a></li>
<li><a href="index8cef.html?date=2017-2">2017年2月 (3)</a></li>
<li><a href="index8bcc.html?date=2017-1">2017年1月 (4)</a></li>
<li><a href="index9f2f.html?date=2016-12">2016年12月 (1)</a></li>
<li><a href="index50f5.html?date=2016-11">2016年11月 (2)</a></li>
<li><a href="indexf32d.html?date=2016-10">2016年10月 (3)</a></li>
<li><a href="index91d7.html?date=2016-9">2016年9月 (1)</a></li>
<li><a href="index917c.html?date=2016-8">2016年8月 (6)</a></li>
<li><a href="index34d3.html?date=2016-7">2016年7月 (1)</a></li>
<li><a href="indexe6af.html?date=2016-6">2016年6月 (4)</a></li>
<li><a href="index1d06.html?date=2016-5">2016年5月 (4)</a></li>
 </ul>
 
</div>  </aside>


<article>
    
        <h1><a href="indexfddb.html?id=52">HTML5音乐可视化</a></h1>
    

    <div class="article-meta">
        <span class="article-author">
        
        <i class="fa fa-pencil"></i>
        <a target="_blank" href="indexd381.html?auth=1" title="otakustay">smallyu</a>
    
</span>

        <time><i class="fa fa-clock-o"></i> 2017-05-17</time>

        
        <span class="article-tags"><i class="fa fa-tag"></i> <a href="indexbcaa.html?tags=46" target="_blank">HTML5</a>&nbsp;</span>
	    
    
    </div>
        <p>在线demo：<a href="web/passionate/index.html" _src="http://oldblog.smallyu.net/web/passionate/" target="_blank">http://oldblog.smallyu.net/web/passionate/</a></p><p><img src="../www.smallyu.net.img.800cdn.com/zb_users/upload/2017/05/201705141494766236320962.html" title="搜狗截图20170514204448.png" alt="搜狗截图20170514204448.png" width="547" height="277" style="width: 592px; height: 312px;"/></p><p><strong><br/></strong></p><p>下面梳理一下HTML5实现音乐可视化的流程。</p><p><strong>搭建静态页面</strong></p><p>静态页面的结构分三部分，header，left，right。header为语义化标签，left和right都用div来实现。</p><p><img src="zb_users/upload/2017/05/201705141494770946657494.png" title="搜狗截图20170514220851.png" alt="搜狗截图20170514220851.png" width="361" height="250" style="width: 361px; height: 250px;"/></p><p>类似这样，然后把背景颜色改为黑色，字体改成白色，加上或不加边框线，给一定padding或margin，静态页面就搭建好啦。</p><p>不过重点不是页面布局。可以在左侧栏有一个曲目列表，点击切歌。这里就不那么麻烦，直接后台加载指定的歌曲。歌曲是许嵩的烟花笑，左侧栏显示部分歌词。</p><p><strong>创建音频文件对象</strong></p><p>AudioContext对象用于获取音频文件源。</p><blockquote><p>（节点）AudioContext：包含各个AudioNode对象以及它们的联系的对象，可以理解为上下文对象。绝大多数情况下，一个document中只有一个AudioContext。</p><p>（方法）createBufferSource()：创建audioBufferSourceNode对象。</p></blockquote><p>可以这样写：</p><pre class="prism-highlight prism-language-javascript">var&nbsp;ac&nbsp;=&nbsp;new&nbsp;window.AudioContext();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;实例化ac为一个音频对象
var&nbsp;bs&nbsp;=&nbsp;ac.createBufferSource();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;用bs来保存音频文件资源</pre><p>有了音频资源，是否就可以播放音频了呢？当然不可以，因为还没有指定文件，告诉对象播放哪一个音频文件。</p><p><strong>获取音频数据</strong></p><p>创建bufferSource后，到了AudioBufferSourceNode这个节点。这个节点有一个属性值buffer，用来指定文件资源。这个属性值需要一个buffer类型的数据。</p><blockquote><p>（节点）<span style="text-decoration: underline;">AudioBufferSourceNode</span>：表示内存中的一段音频资源，其音频数据存在于AudioBuffer中（其buffer属性）。</p><p>（属性）<span style="text-decoration: underline;">buffer</span>：AudioBuffer对象，表示要播放的音频资源数据。</p></blockquote><p>获取buffer有两种方式，一种是ajax设置返回值类型为arraybuffer，然后解码，一种是用FileReader读取文件，获得blob值。后一种方式多用input上传文件后获得文件，再进行解析。前面一种好用一点。（留坑）<br/></p><p>ajax的原生写法：</p><pre class="prism-highlight prism-language-javascript">var&nbsp;url=&quot;...&quot;;
var&nbsp;xhr&nbsp;=&nbsp;new&nbsp;XMLHttpRequest();
xhr.abort();
xhr.open(&quot;GET&quot;,&nbsp;url);
xhr.responseType&nbsp;=&nbsp;&quot;arraybuffer&quot;;
xhr.onload&nbsp;=&nbsp;function(){
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;xhr.response;
}
xhr.send();</pre><p>onload触发的函数中xhr.response就是我们想要的值。</p><blockquote><p>（方法）<span style="text-decoration: underline;">decodeAudioData(arrayBuffer, succ(buffer), err)&nbsp;</span>：异步解码包含在arrayBuffer中的音频数据。</p></blockquote><p>将arraybuffer解码：</p><pre class="prism-highlight prism-language-javascript">ac.decodeAudioData(arraybuffer,&nbsp;function(buffer){&nbsp;...&nbsp;},function(err){&nbsp;...&nbsp;});
bs.buffer&nbsp;=&nbsp;buffer;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;回调函数中的buffer就是想要的buffer</pre><p><strong>播放音乐</strong><br/></p><blockquote><p>（方法）<span style="text-decoration: underline;">start</span>：开始播放音频</p></blockquote><p>这个时候调用start方法：</p><pre class="prism-highlight prism-language-javascript">bs.start(0);</pre><p>打开页面，音乐开始播放。</p><p><strong>音量控制</strong></p><blockquote><p>（节点）<span style="text-decoration: underline;">GainNode</span>：改变音频音量的对象，会改变通过它的音频数据所有的sample frame的信号强度。</p><p>（方法）<span style="text-decoration: underline;">createGain()</span>：创建GainNode对象。</p><p>（属性）<span style="text-decoration: underline;">value</span>：可以改变音频信号的强弱，默认为1，最小值为0。</p></blockquote><p>音乐播放还不行，要添加一个音量控制控件，音量控制用GainNode节点：</p><pre class="prism-highlight prism-language-javascript">var&nbsp;gainNode&nbsp;=&nbsp;accreateGain();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;创建GainNode对象
gainNode.connect(ac.destination);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;将gainNode连接到AudioDestinationNode节点</pre><p>这样就有了一个音量控制的对象。</p><pre class="prism-highlight prism-language-javascript">gainNode.gain.value=&nbsp;...&nbsp;;</pre><p>gain.value用于控制输入信号的强弱，也就是音量的大小。HTML中用type为range的input，把值传递给对象，就可以实时控制音量了。<br/></p><p><strong>得到音频解析数据</strong></p><blockquote><p>（节点）<span style="text-decoration: underline;">AnalyserNode</span>：音频分析对象，他能实时的分析音频资源的频域和时域信息，但不会对音频流做任何处理。</p><p>（方法）<span style="text-decoration: underline;">createAnalyser()</span>：创建AnalyserNode对象。</p></blockquote><blockquote><p>（属性）<span style="text-decoration: underline;">fftsize</span>：设置FFT（是离散傅里叶变换的快速算法，用于将一个信号变换到频域）值的大小，用于分析得到频域，为32 ~ 2048之间2的整数次倍，默认为2048，实时得到的音频频域的数据个数为fftSize的一半。</p><p>（属性）<span style="text-decoration: underline;">frequencyBinCount</span>，FFT值的一半，即实时得到的音频频域的数据个数</p></blockquote><blockquote><p>（方法）<span style="text-decoration: underline;">getByteFrequencyData(Uint8Array)</span>，复制音频当前的频域数据（数量是frequencyBinCount）到Uint8Array（8位无符号整型类型化数组）中。</p></blockquote><p>先创建AnalyserNode对象，然后设置fftsize的值。FFT用于数字信号的处理，会把音频文件流输入的信号变换到频域，用getByteFrequencyData()方法得到经系统处理之后的频域数据。</p><pre class="prism-highlight prism-language-javascript">var&nbsp;analyser&nbsp;=&nbsp;ac.createAnalyser();&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;实例化对象
analyser.fftSize&nbsp;=&nbsp;32;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;设置fftsize
var&nbsp;arr&nbsp;=&nbsp;new&nbsp;Uint8Array(analyser.frequencyBinCount);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;getByteFrequencyData()方法要求参数为8位无符号整型类型化数组
analyser.getByteFrequencyData(arr);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;arr为所需频域数据</pre><p>这样得到的数组arr就是用于可视化效果绘制的数据。</p><blockquote><p><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">（方法）</span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;; text-decoration: underline;">window.requestAnimationFrame()</span><span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">：</span>告诉浏览器您希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法将在重绘之前调<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">用的回</span>调作为参数。</p></blockquote><p>一次解析只能得到一组数据，所以需要<span style="font-family: 微软雅黑, &#39;Microsoft YaHei&#39;;">requestAnimationFrame不断解析，不断得到arr。</span></p><p><strong>前端界面绘制</strong></p><p>前端界面使用canvas绘制，实现音乐可视化的效果。</p><pre class="prism-highlight prism-language-javascript">var&nbsp;box&nbsp;=&nbsp;document.getElementById(&quot;right&quot;);&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;获取right区域的dom
box.appendChild(canvas);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;创建canvas节点
var&nbsp;ctx&nbsp;=&nbsp;canvas.getContext(&quot;2d&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;实例化canvas画笔</pre><p>接下来就是使用for循环和ctx画矩形、圆圈，填充渐变的操作了。（留坑吧，估计不填了）<br/></p><p><br/></p><p>案例用到web Audio API的关系：</p><p><img src="zb_users/upload/2017/05/201705141494773947635812.png" title="搜狗截图20170514203204.png" alt="搜狗截图20170514203204.png" width="777" height="557" style="width: 777px; height: 557px;"/></p><p>虚线是可以跳过的节点，直接播放音频文件。好吧有错。</p>    
</article>
<nav class="article-pagination">
    
    <a href="index7d36.html?id=51" class="article-prev">前一篇: 活着那么累，和我一起去死吧</a>    <a href="index3ca5.html?id=53" class="article-next">后一篇: 大误：被人嫌弃的感觉是这样的</a></nav>



<footer>
<p class="copy">Copyright Hower'Blog Rights Reserved.&nbsp;&nbsp;. Powered By <a href="http://www.zblogcn.com/" rel="nofollow" target="_blank">Z-BlogPHP</a>. theme by <a href="http://www.laiweishang.com/" target="_blank">微商货源</a></p></footer>
</body>
<!-- Mirrored from oldblog.smallyu.net/?id=52 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Jan 2020 07:50:23 GMT -->
</html>


<!--5.29 ms , 9 query , 656kb memory , 0 error-->